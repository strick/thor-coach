graph TB
    subgraph "Client Layer"
        USER[ğŸ‘¤ User]
        WEB[ğŸŒ Web Dashboard<br/>Tailwind CSS + Chart.js<br/>:3001]
        AGENT_UI[ğŸ’¬ Conversational Agent<br/>Natural Language Interface<br/>:3002]
    end

    subgraph "Agent Layer - AI Orchestration"
        AGENT[ğŸ¤– Thor Agent<br/>LLM Tool Calling<br/>Session Management]
        MCP[ğŸ”Œ MCP Server<br/>Model Context Protocol<br/>8 AI Tools]
    end

    subgraph "Application Layer"
        API[âš¡ REST API<br/>Express + TypeScript<br/>:3000]
        PARSER[ğŸ§  NLP Parser<br/>LLM-Powered<br/>Workout Understanding]
        CRON[â° Automation<br/>Weekly Reports<br/>Cron Jobs]
    end

    subgraph "Data Layer"
        DB[(ğŸ’¾ SQLite Database<br/>workout.db<br/>Local Storage)]
    end

    subgraph "AI/LLM Layer"
        LLM1[ğŸŒŸ LLM #1: Agent<br/>Ollama / OpenAI<br/>Tool Routing]
        LLM2[ğŸŒŸ LLM #2: Parser<br/>Ollama / OpenAI<br/>Text Analysis]
    end

    subgraph "Shared Libraries"
        SHARED[ğŸ“¦ @thor/shared<br/>TypeScript Types<br/>Zod Schemas]
    end

    USER -.->|Web UI| WEB
    USER -.->|Chat| AGENT_UI

    WEB -->|HTTP REST| API
    AGENT_UI -->|HTTP| AGENT

    AGENT <-->|Prompts & Responses| LLM1
    AGENT <-->|JSON-RPC<br/>stdio| MCP

    MCP -->|HTTP REST| API

    API --> PARSER
    PARSER <-->|Parse Workouts| LLM2

    API <-->|SQL| DB
    CRON -->|Generate Summaries| API
    CRON <-->|AI Insights| LLM2

    API -.uses.-> SHARED
    MCP -.uses.-> SHARED
    AGENT -.uses.-> SHARED

    classDef userLayer fill:#4CAF50,stroke:#2E7D32,stroke-width:2px,color:#fff
    classDef agentLayer fill:#2196F3,stroke:#1565C0,stroke-width:2px,color:#fff
    classDef appLayer fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff
    classDef dataLayer fill:#9C27B0,stroke:#6A1B9A,stroke-width:2px,color:#fff
    classDef llmLayer fill:#E91E63,stroke:#AD1457,stroke-width:2px,color:#fff
    classDef sharedLayer fill:#607D8B,stroke:#37474F,stroke-width:2px,color:#fff

    class USER,WEB,AGENT_UI userLayer
    class AGENT,MCP agentLayer
    class API,PARSER,CRON appLayer
    class DB dataLayer
    class LLM1,LLM2 llmLayer
    class SHARED sharedLayer
