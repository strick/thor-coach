graph LR
    %% Input Layer
    subgraph Input["üé§ Input Layer"]
        Voice["Voice Input<br/>(Speech-to-Text)"]
        Text["Text Input<br/>(Chat/API)"]
    end

    %% Meta Runner (Orchestrator)
    subgraph MetaLayer["üß† Meta Runner"]
        MetaRunner["Meta Agent<br/><i>Orchestrator</i>"]
    end

    %% Domain Agents Layer
    subgraph DomainAgents["ü§ñ Domain Agents"]
        ThorCoach["Thor Coach<br/><i>Workout Planning</i>"]
        NutritionAgent["Nutrition Agent<br/><i>Diet & Macros</i>"]
        HealthAgent["Health Agent<br/><i>Vitals & Recovery</i>"]
        OverviewAgent["Overview Agent<br/><i>Analytics & Insights</i>"]
    end

    %% MCP Tools Layer
    subgraph MCPTools["üîß MCP Tools"]
        WorkoutTools["Workout Tools<br/>‚Ä¢ log_workout<br/>‚Ä¢ get_exercises<br/>‚Ä¢ get_history"]
        NutritionTools["Nutrition Tools<br/>‚Ä¢ log_meal<br/>‚Ä¢ get_macros<br/>‚Ä¢ track_calories"]
        HealthTools["Health Tools<br/>‚Ä¢ log_vitals<br/>‚Ä¢ track_sleep<br/>‚Ä¢ monitor_recovery"]
        SummaryTools["Summary Tools<br/>‚Ä¢ weekly_summary<br/>‚Ä¢ progress_report<br/>‚Ä¢ analytics"]
    end

    %% API Layer
    subgraph APILayer["üåê Local APIs"]
        WorkoutAPI["Workout API<br/><i>Express + TypeScript</i>"]
        NutritionAPI["Nutrition API<br/><i>Express + TypeScript</i>"]
        HealthAPI["Health API<br/><i>Express + TypeScript</i>"]
    end

    %% Data Layer
    subgraph DataLayer["üíæ Data Layer"]
        SQLite["SQLite Database<br/><i>Local-First Storage</i>"]
    end

    %% Connections - Input to Meta Runner
    Voice --> MetaRunner
    Text --> MetaRunner

    %% Connections - Meta Runner to Domain Agents
    MetaRunner --> ThorCoach
    MetaRunner --> NutritionAgent
    MetaRunner --> HealthAgent
    MetaRunner --> OverviewAgent

    %% Connections - Domain Agents to MCP Tools
    ThorCoach --> WorkoutTools
    ThorCoach --> SummaryTools

    NutritionAgent --> NutritionTools
    NutritionAgent --> SummaryTools

    HealthAgent --> HealthTools
    HealthAgent --> SummaryTools

    OverviewAgent --> WorkoutTools
    OverviewAgent --> NutritionTools
    OverviewAgent --> HealthTools
    OverviewAgent --> SummaryTools

    %% Connections - MCP Tools to APIs
    WorkoutTools --> WorkoutAPI
    NutritionTools --> NutritionAPI
    HealthTools --> HealthAPI
    SummaryTools --> WorkoutAPI
    SummaryTools --> NutritionAPI
    SummaryTools --> HealthAPI

    %% Connections - APIs to Database
    WorkoutAPI --> SQLite
    NutritionAPI --> SQLite
    HealthAPI --> SQLite

    %% Styling
    classDef inputStyle fill:#4A90E2,stroke:#2E5C8A,stroke-width:2px,color:#fff
    classDef metaStyle fill:#7B68EE,stroke:#4B0082,stroke-width:3px,color:#fff
    classDef agentStyle fill:#50C878,stroke:#2D7A4A,stroke-width:2px,color:#fff
    classDef mcpStyle fill:#FF6B6B,stroke:#C92A2A,stroke-width:2px,color:#fff
    classDef apiStyle fill:#FFA500,stroke:#CC8400,stroke-width:2px,color:#fff
    classDef dataStyle fill:#95A5A6,stroke:#5D6D7E,stroke-width:2px,color:#fff

    class Voice,Text inputStyle
    class MetaRunner metaStyle
    class ThorCoach,NutritionAgent,HealthAgent,OverviewAgent agentStyle
    class WorkoutTools,NutritionTools,HealthTools,SummaryTools mcpStyle
    class WorkoutAPI,NutritionAPI,HealthAPI apiStyle
    class SQLite dataStyle
